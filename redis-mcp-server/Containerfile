
FROM rust:1.80 AS builder
WORKDIR /app
COPY . .
RUN --mount=type=cache,target=/usr/local/cargo/registry     --mount=type=cache,target=/app/target     cargo build --release

FROM debian:bookworm-slim
RUN useradd -m app
COPY --from=builder /app/target/release/redis-mcp-server /usr/local/bin/redis-mcp-server
USER app
ENV REDIS_URL=redis://host.docker.internal:6379/0     RUST_LOG=info
ENTRYPOINT ["/usr/local/bin/redis-mcp-server"]
